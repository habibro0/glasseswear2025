app.get('/cart', async (req, res) => {
  try {
    const cart = req.session.cart || [];  // Ensure cart is not undefined
    console.log("Cart items:", cart);

    const cartDetails = await Promise.all(
      cart.map(async (item) => {
        const product = await Listing.findById(item.productId);
        console.log("Product fetched:", product);  // Check if the product is fetched correctly
        return { ...product.toObject(), quantity: item.quantity };
      })
    );
    res.render('listings/cart.ejs', { cartDetails });
  } catch (err) {
    console.log("Error fetching cart:", err);
    res.status(500).send("Server Error");
  }
});
